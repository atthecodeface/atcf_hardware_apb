int vector_number
string failure_reason

bfm_wait 10

sprintf failure_reason "acknowledge should start low"
bne apb_processor_response__acknowledge.value() 0 test_fail

apb_processor_request__address.drive 1
apb_processor_request__valid.drive 1

sprintf failure_reason "acknowledge should get set within 50 cycles"
apb_processor_response__acknowledge.wait_for_value 1 50
bne apb_processor_response__acknowledge.value() 1 test_fail
apb_processor_request__valid.drive 0
bfm_wait 1

sprintf failure_reason "acknowledge should get cleared after 1 cycle if valid goes away"
bne apb_processor_response__acknowledge.value() 0 test_fail

sprintf failure_reason "busy should get set"
apb_processor_response__rom_busy.wait_for_value 1 50
bne apb_processor_response__rom_busy.value() 1 test_fail

sprintf failure_reason "busy should clear within a time"
apb_processor_response__rom_busy.wait_for_value 0 200
bne apb_processor_response__rom_busy.value() 0 test_fail

pass global_cycle() "Test succeeded"

end

test_fail:
printf "Test failed, cycle %d0%, reason %d1%" global_cycle() 0
sprintf failure_reason "**************************************************************************** Test failed : %s0%" failure_reason
fail vector_number failure_reason
end



